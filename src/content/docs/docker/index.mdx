---
title: Docker を使った Web 開発のためのドキュメント
---

import { Code } from '@astrojs/starlight/components';

## はじめに

このドキュメントでは、Docker を利用したあしたぼコマ表の開発環境構築と、基本的な操作方法について説明します。
開発には Next.js と TypeScript を使用します。

## 環境構築

開発に必要なソフトウェアをインストール・設定します。VS Code や Git の基本的なインストール方法は、「デザイン開発のためのドキュメント」も参考にしてください。

### Visual Studio Code (VS Code)

コードエディタとして VS Code を使用します。まだインストールしていない場合は、以下のリンクからインストールしてください。
[VS Code 公式サイト](https://code.visualstudio.com/)

**推奨拡張機能:**

以下の拡張機能を VS Code にインストールしておくと、開発がスムーズになります。

-   **Git Graph:** Git の履歴を視覚的に表示します。
-   **Tailwind CSS IntelliSense:** Tailwind CSS のクラス名を補完します。
-   **WSL:** Windows Subsystem for Linux (WSL) との連携を強化します。
-   **Docker:** Docker コンテナやイメージの管理を VS Code 上で行えるようにします。
-   **(任意) Database Client:** データベースへの接続や操作を VS Code 上で行えます。（バックエンド開発に関わる場合）

### WSL, Ubuntu, Docker

Windows 環境で Linux ベースの開発を行うために、WSL (Windows Subsystem for Linux) と Ubuntu、そしてコンテナ化技術である Docker を導入します。

**1. WSL の有効化:**

-   Windows の検索バーで「Windows の機能の有効化または無効化」と検索し、設定パネルを開きます。
-   リストの中から「Linux 用 Windows サブシステム」にチェックを入れ、「OK」をクリックします。再起動が必要な場合があります。
    ![WSL 有効化](/assets/images/docker/image-01.png)

**2. WSL 2 の設定と Ubuntu のインストール:**

-   コマンドプロンプト（または PowerShell）を **管理者として実行** します。
-   以下のコマンドを実行し、WSL のデフォルトバージョンを 2 に設定します。
    ```bash
    wsl --set-default-version 2
    ```
-   次に、Ubuntu ディストリビューションをインストールします。
    ```bash
    wsl --install -d Ubuntu
    ```
    インストール中に、Ubuntu で使用する **UNIX ユーザー名** と **パスワード** の設定を求められます。任意のユーザー名とパスワードを入力してください。（パスワード入力時は画面に表示されませんが、入力はされています。）

**3. Docker Desktop のインストール:**

-   [Docker Desktop 公式サイト](https://www.docker.com/products/docker-desktop/) からインストーラーをダウンロードし、実行します。
-   画面の指示に従ってインストールを進めます。設定は基本的にデフォルトのままで問題ありません。（Docker Hub へのサインインは必須ではありません。）
-   インストール完了後、Docker Desktop を起動します。

**4. Docker Desktop と WSL の連携設定:**

-   Docker Desktop の設定画面を開きます。（タスクトレイの Docker アイコンを右クリック > Settings）
-   「Resources」>「WSL Integration」を選択します。
-   「Enable integration with my default WSL distro」がオンになっていることを確認し、「Ubuntu」ディストリビューションのトグルスイッチもオンにします。
    ![Docker WSL 連携設定](/assets/images/docker/image-02.png)
-   「Apply & Restart」をクリックして設定を適用します。

これで WSL、Ubuntu、Docker の基本的な設定は完了です。エラーが発生した場合は、エラーメッセージを確認し、担当者（わたべ）に相談してください。

### Git と GitHub

Git と GitHub の設定を行います。「デザイン開発のためのドキュメント」と重複する部分もありますが、WSL (Ubuntu) 環境での設定が必要な箇所もあります。

**1. Git のインストール (Ubuntu):**

-   コマンドプロンプトで `wsl` と入力し、Ubuntu 環境に入ります。
-   以下のコマンドを実行して、Ubuntu に Git をインストールします。
    ```bash
    sudo apt update
    sudo apt install git -y
    ```
-   インストール後、バージョンを確認します。
    ```bash
    git --version
    ```

**2. Git の初期設定 (Ubuntu):**

Ubuntu 環境内で、Git のユーザー名とメールアドレスを設定します。Windows 環境で設定したものと同じ情報を設定してください。

```bash
git config --global user.name "あなたのGitHubユーザー名"
git config --global user.email "あなたのGitHub登録メールアドレス"
```

**3. GitHub アカウント:**

GitHub アカウントがまだない場合は作成し、ユーザー名を担当者（わたべ）に伝えてください。

**4. リポジトリのクローン (Ubuntu):**

-   Ubuntu 環境 (WSL ターミナル) を開きます。
-   ホームディレクトリに移動します。
    ```bash
    cd ~
    ```
-   以下のコマンドを実行して、リポジトリをクローンします。
    ```bash
    git clone https://github.com/watabegg/k_on_line.git
    ```
    ホームディレクトリ直下に `k_on_line` フォルダが作成されれば成功です。
    ![リポジトリクローン完了 (Ubuntu)](/assets/images/docker/github-02.png)
    （上記画像は Windows 環境のものですが、同様のメッセージが表示されます。）

**GitHub Tips (任意):**

「デザイン開発のためのドキュメント」を参照してください。

---

これで Docker を利用した開発のための環境構築は完了です。

## 実行編

Docker 環境でプロジェクトを実行する手順を説明します。

### VS Code で WSL 上のプロジェクトを開く

1.  VS Code を起動します。
2.  左下の緑色の部分（リモート接続ステータス）をクリックするか、`Ctrl+Shift+P` でコマンドパレットを開き `WSL: Connect to WSL` を選択します。
3.  接続先のディストリビューションとして `Ubuntu` を選択します。新しい VS Code ウィンドウが WSL 環境に接続された状態で開きます。
4.  VS Code のメニューから「ファイル」>「フォルダーを開く」を選択します。
5.  ファイル選択ダイアログで、Ubuntu のホームディレクトリ (`/home/あなたのUbuntuユーザー名/`) にある `k_on_line` フォルダを選択し、「OK」をクリックします。
6.  VS Code のエクスプローラーにプロジェクトファイルが表示されれば成功です。

### 環境変数の設定

「デザイン開発のためのドキュメント」の「環境変数の設定」セクションを参照し、同様の手順で WSL 上のプロジェクトルートに `.env` ファイルを作成し、担当者から受け取った内容を貼り付けて保存してください。

### プロジェクトの実行 (Docker Compose)

**重要:** プロジェクトを実行する前に、**Docker Desktop が起動していること** を必ず確認してください。実行中も Docker Desktop は起動したままにしてください。

1.  **VS Code の統合ターミナルを開く:** VS Code のメニューから「ターミナル」>「新しいターミナル」を選択します。ターミナルが WSL (Ubuntu) 環境で開かれていることを確認してください。（プロンプトが `@` を含む Linux 形式になっているはずです。）
2.  **Docker コンテナのビルドと起動:** 以下のコマンドを **一行ずつ順番に** 実行します。
    ```bash
    make new
    ```
    初回ビルド時に実行します。依存関係のインストールとイメージのビルドが行われます。
    ```bash
    make up
    ```
    Docker コンテナをバックグラウンドで起動します。

    これらのコマンドは、プロジェクトルートにある `Makefile` に定義されたショートカットです。内部的には `docker compose` コマンドが実行されています。
    実行には時間がかかる場合があります。大量のログが出力されますが、`error` や `failed` といったメッセージが表示されなければ、正常に進行しています。

    **エラーが発生した場合:** コマンド実行中にエラーメッセージが表示された場合は、ターミナルの出力を記録し、担当者（わたべ）に相談してください。

3.  **ブラウザで確認:** コンテナが正常に起動したら、Web ブラウザを開き、`http://localhost:3000` にアクセスします。あしたぼコマ表のページが表示されれば成功です。

### 開発サーバーの停止と再起動 (Docker Compose)

**停止方法:**

開発作業を終了する際は、VS Code の統合ターミナルで以下のコマンドを実行します。

```bash
make down
```

これにより、起動している Docker コンテナが停止・削除されます。停止後は `http://localhost:3000` にアクセスできなくなります。Docker Desktop を終了しても構いません。

**再起動方法:**

再度開発を開始する場合は、Docker Desktop を起動し、VS Code の統合ターミナルで以下のコマンドを実行します。

```bash
make up
```

（`make new` は、`Dockerfile` や依存関係に変更がない限り、再実行する必要はありません。）

**コンテナの再ビルドを伴う再起動:**

`package.json` の依存関係を変更した場合など、Docker イメージの再ビルドが必要な場合は、以下のコマンドを使用します。

```bash
make renew
```

これは内部的に `make down`、`make new`、`make up` を順に実行します。

**キャッシュ削除を伴う再ビルド:**

ビルドキャッシュが原因で問題が発生している疑いがある場合は、以下のコマンドでキャッシュを削除してから再ビルド・起動します。

```bash
make clean
make new
make up
```

---

これで Docker 環境での実行に関する説明は終わりです。
次は、実際にコードを編集していく「React の基礎」や「いざコード編集してみよう」のドキュメントに進みましょう。
